---
// src/pages/index.astro
import Layout from "../layouts/Layout.astro";
import Loader from "../components/Loader.astro";

export const prerender = true;

const supportedLangs = ['es', 'en'];
const defaultLang = 'es'; // Valor por defecto para SSR (prerender)

// Solo se ejecuta en el cliente (importante!)
const userLang = typeof window !== 'undefined' 
  ? (localStorage.getItem('preferredLang') || 
     (navigator.language.startsWith('es') ? 'es' : 'en'))
  : defaultLang;
---

<Layout
  title={userLang === 'es' 
      ? 'El Pensadero HP - Teorías Mágicas Reveladas' 
      : 'The HP Pensive - Magic Theories Uncovered'}
  description={
    userLang === 'es'
      ? 'Portal a las teorías mejor guardadas del universo Harry Potter. Redirigiendo a contenido exclusivo...'
      : 'Gateway to the best-kept Harry Potter theories. Redirecting to exclusive content...'
  }
  url="/"
>
  <main class="relative h-[calc(100vh-100px)] xl:min-h-screen w-full flex flex-col items-center justify-center">
    <section class="flex flex-col items-center justify-center border px-10 my-10 rounded-full">
      <Loader client:load /> {/* 'client:load' es crucial */}
    </section>

    <script is:inline>
      // Redirección después de 1.5s (evita flash)
      setTimeout(() => {
        window.location.href = `/${userLang}`;
      }, 800);
    </script>
  </main>
</Layout>